<div class="evenements-container">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-overlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Chargement des événements...</p>
        </div>
    </div>

    <!-- Main Content -->
    <div *ngIf="!loading" class="evenements-content">
        <!-- Header Section -->
        <div class="evenements-header">
            <div class="header-left">
                <h1 class="page-title">Événements</h1>
                <p class="page-subtitle">Découvrez et participez aux événements de la coopérative</p>
            </div>
            <div class="header-stats">
                <div class="stat-badge">
                    <i class="stat-icon"><i class="bi bi-calendar-event-fill"></i></i>
                    <div>
                        <span class="stat-number">{{ evenements.length || 0 }}</span>
                        <span class="stat-label">Événements</span>
                    </div>
                </div>
                <div class="stat-badge inscription">
                    <i class="stat-icon"><i class="bi bi-check-circle-fill"></i></i>
                    <div>
                        <span class="stat-number">{{ mesInscriptions.length || 0 }}</span>
                        <span class="stat-label">Inscriptions</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="alert alert-error">
            <i class="alert-icon"><i class="bi bi-exclamation-triangle-fill"></i></i>
            <div>
                <strong>Erreur</strong>
                <p>{{ errorMessage }}</p>
            </div>
        </div>

        <div *ngIf="!errorMessage">
            <!-- Mes Inscriptions Section -->
            <div class="section-card">
                <div class="section-header">
                    <div class="header-title-wrapper">
                        <div class="section-icon"><i class="bi bi-check-circle-fill"></i></div>
                        <div>
                            <h2>Mes Inscriptions</h2>
                            <p class="section-subtitle">Les événements auxquels vous êtes inscrit</p>
                        </div>
                    </div>
                    <span class="count-badge">{{ mesInscriptions.length || 0 }}</span>
                </div>

                <div *ngIf="mesInscriptions.length; else noIns" class="inscriptions-grid">
                    <div *ngFor="let it of mesInscriptions" class="inscription-card">
                        <div class="card-ribbon">
                            <span>Inscrit</span>
                        </div>

                        <div class="card-header">
                            <div class="event-icon"><i class="bi bi-calendar-event-fill"></i></div>
                            <div class="card-header-content">
                                <h3 class="event-title">
                                    {{ it.titre || it.evenement?.titre || it.code_evenement ||
                                    it.evenement?.code_evenement || 'Événement' }}
                                </h3>
                                <div class="event-meta-inline">
                                    <span class="meta-item" *ngIf="getEventDate(it)">
                                        <i class="meta-icon"><i class="bi bi-calendar-check-fill"></i></i>
                                        {{ formatDate(getEventDate(it)!) }}
                                    </span>
                                    <span class="meta-item">
                                        <i class="meta-icon"><i class="bi bi-geo-alt-fill"></i></i>
                                        {{ getEventLocation(it) }}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="card-actions">
                            <a *ngIf="it.code_evenement || it.evenement?.code_evenement"
                                [routerLink]="['/membre/evenements', (it.code_evenement || it.evenement?.code_evenement)]"
                                class="btn btn-detail">
                                <i class="btn-icon"><i class="bi bi-eye-fill"></i></i>
                                Voir les détails
                            </a>
                        </div>
                    </div>
                </div>

                <ng-template #noIns>
                    <div class="empty-state">
                        <i class="empty-icon"><i class="bi bi-clipboard-x"></i></i>
                        <h4>Aucune inscription</h4>
                        <p>Vous n'êtes inscrit à aucun événement pour le moment.</p>
                        <p class="empty-hint">Explorez les événements ci-dessous pour vous inscrire !</p>
                    </div>
                </ng-template>
            </div>

            <!-- Tous les Événements Section -->
            <div class="section-card">
                <div class="section-header">
                    <div class="header-title-wrapper">
                        <div class="section-icon"><i class="bi bi-calendar-event"></i></div>
                        <div>
                            <h2>Tous les Événements</h2>
                            <p class="section-subtitle">Découvrez les prochains événements</p>
                        </div>
                    </div>
                    <span class="count-badge">{{ evenements.length || 0 }}</span>
                </div>

                <div *ngIf="evenements.length; else empty" class="evenements-list">
                    <div *ngFor="let e of evenements" class="event-card">
                        <div class="event-card-header">
                            <div class="event-date-badge" *ngIf="e.date_debut">
                                <div class="date-day">{{ getEventDay(e.date_debut) }}</div>
                                <div class="date-month">{{ getEventMonth(e.date_debut) }}</div>
                            </div>
                            <div class="event-date-badge" *ngIf="!e.date_debut">
                                <div class="date-day">--</div>
                                <div class="date-month">---</div>
                            </div>
                            <div class="event-status" [class]="getEventStatusClass(e)">
                                <span class="status-dot"></span>
                                {{ getEventStatus(e) }}
                            </div>
                        </div>

                        <div class="event-card-content">
                            <h3 class="event-name">{{ e.titre || e.code_evenement }}</h3>
                            <p class="event-description" *ngIf="e.description">
                                {{ truncateDescription(e.description) }}
                            </p>

                            <div class="event-meta">
                                <div class="meta-row" *ngIf="e.date_debut">
                                    <i class="meta-icon"><i class="bi bi-calendar-check-fill"></i></i>
                                    <span>{{ formatDate(e.date_debut) }}</span>
                                </div>
                                <div class="meta-row" *ngIf="e.heure_debut">
                                    <i class="meta-icon"><i class="bi bi-clock-fill"></i></i>
                                    <span>{{ e.heure_debut }}</span>
                                </div>
                                <div class="meta-row" *ngIf="e.lieu">
                                    <i class="meta-icon"><i class="bi bi-geo-alt-fill"></i></i>
                                    <span>{{ e.lieu }}</span>
                                </div>
                                <div class="meta-row" *ngIf="e.participants_count">
                                    <i class="meta-icon"><i class="bi bi-people-fill"></i></i>
                                    <span>{{ e.participants_count }} participant(s)</span>
                                </div>
                                <div class="meta-row" *ngIf="e.type">
                                    <i class="meta-icon bi" [ngClass]="getEventTypeIcon(e.type)"></i>
                                    <span>{{ e.type }}</span>
                                </div>
                            </div>
                        </div>

                        <div class="event-card-footer">
                            <div class="footer-info">
                                <span class="inscription-badge" *ngIf="isInscrit(e)">
                                    <i class="badge-icon"><i class="bi bi-check-circle-fill"></i></i>
                                    Inscrit
                                </span>
                            </div>
                            <a *ngIf="e.code_evenement" [routerLink]="['/membre/evenements', e.code_evenement]"
                                class="btn btn-primary-outline">
                                <span>Découvrir</span>
                                <i class="arrow-icon">→</i>
                            </a>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination-wrapper">
                        <button type="button" class="btn btn-pagination" (click)="prevPage()" [disabled]="page <= 1">
                            <i class="arrow-left">←</i>
                            Précédent
                        </button>
                        <span class="page-indicator">Page {{ page }}</span>
                        <button type="button" class="btn btn-pagination" (click)="nextPage()">
                            Suivant
                            <i class="arrow-right">→</i>
                        </button>
                    </div>
                </div>

                <ng-template #empty>
                    <div class="empty-state">
                        <i class="empty-icon"><i class="bi bi-calendar-x"></i></i>
                        <h4>Aucun événement disponible</h4>
                        <p>Il n'y a pas d'événements programmés pour le moment.</p>
                        <p class="empty-hint">Revenez plus tard pour découvrir de nouveaux événements !</p>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</div>